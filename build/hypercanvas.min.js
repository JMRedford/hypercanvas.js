function emptyOrientation(a){orientation=[];for(var b=0;a>b;b++)for(var c=b+1;a>c;c++)orientation[orientation.length]={dims:[b,c],angle:0};return orientation}function initDimSelect(){$("#dim-select").change(function(){var a=parseInt($(this).siblings(".ui-slider-track").children().attr("aria-valuenow"));lastVal!=a&&(lastVal=a,project.clear(),demo=new SinDemo(a))})}function clone(a){return jQuery.extend({},a)}function hcInit(){paper.install(window),view.center=[0,0]}function getDemo(a,b){for(var c=0;c<b.length;c++)if(b[c].id==a)return b[c].demo;return function(){return console.log("demo not found"),!1}}function decEqual(a,b,c,d){ok(Math.abs(a-b)<=c,d)}function Camera(a,b,c){function d(){return f(c)}function e(a){return{dims:a.dims,angle:-a.angle}}function f(a){return a.map(function(a){return e(a)})}var a=a,b=b,c=c;this.pos=function(){return b},this.setPos=function(a){b=a},this.angle=function(){return c},this.setAngle=function(a){c=a},this.translateDots=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this.translateDot(a[c]);return b},this.translateRopes=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this.translateRope(a[c]);return b},this.translateDot=function(a){return new Dot(this.translateVect(a.pos()),a.color)},this.translateRope=function(a){var b=this;return new Rope(a.segments.map(function(a){return b.translateVect(a)}),a.color)},this.translateVect=function(a){return a.plus(b.inverse())},this.rotateDots=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this.rotateDot(a[c]);return b},this.rotateRopes=function(a){for(var b=[],c=0;c<a.length;c++)b[c]=this.rotateRope(a[c]);return b},this.rotateDot=function(a){return new Dot(this.orientVect(a.pos()),a.color)},this.orientVect=function(a){return a.orient(d())},this.rotateRope=function(a){var b=this;return new Rope(a.segments.map(function(a){return b.orientVect(a)}),a.color)},this.dots=function(){return this.rotateDots(this.translateDots(a.dots()))},this.ropes=function(){return this.rotateRopes(this.translateRopes(a.ropes()))};var g=new CameraImage(this);this.init=function(){g.init()},this.update=function(){g.update()},this.rotateAll=function(a){for(var b=0;b<c.length;b++)c[b].angle+=a},this.init()}function Dot(a,b){var a=a;this.pos=function(){return a},this.xy=function(){var b=a.coords();return{x:b[0],y:b[1]}},this.twoProj=function(b,c){return{x:a.dot(b),y:a.dot(c)}},this.color="string"==typeof b?b:DEFAULT_COLOR}function Rope(a,b){this.segments=a,this.color="string"==typeof b?b:DEFAULT_COLOR}function Rotation(a,b){this.dims=a,this.angle=b}function Space(a){this.dim=a,this.sum=function(){},this.inner=function(){},this.mult=function(){},this.inverse=function(){},this.norm=function(){},this.rotate=function(){},this.newVector=function(){},this.newVectors=function(){},this.basis=function(){},this.origin=function(){}}function Stage(a){function b(b){return new Rope([a.origin(),a.basis(b).mult(500)],DEFAULT_COLOR)}function c(){for(var c=[],d=0;d<a.dim;d++)c[d]=b(d);return c}var a=a,d=[],e=[];this.addDot=function(a){d[d.length]=a},this.newDot=function(b,c){d[d.length]=new Dot(a.newVector(b),c)},this.newDots=function(b,c){d=d.concat(b.map(function(b){return new Dot(a.newVector(b),c)}))},this.newRope=function(b,c){e[e.length]=new Rope(a.newVectors(b),c)},this.newRopes=function(b,c){e=e.concat(b.map(function(b){return new Rope(a.newVectors(b),c)}))},this.dots=function(){return d},this.ropes=function(){return e},this.addRope=function(a){e[e.length]=a},this.addRopes=function(a){e=e.concat(a)},this.addAxes=function(){this.addRopes(c())}}function Vector(a,b){var a=a,b=b;this.coords=function(){return a},this.plus=function(a){return b.sum(this,a)},this.dot=function(a){return b.inner(this,a)},this.mult=function(a){return b.mult(a,this)},this.norm=function(){return b.norm(this)},this.inverse=function(){return b.inverse(this)},this.unit=function(){return 0!=this.norm?b.mult(this,1/this.norm()):0},this.rotate=function(a){return b.rotate(this,a)},this.orient=function(a){return b.orient(this,a)},this.clone=function(){return clone(this)},this.xy=function(){return{x:a[0],y:a[1]}}}function EucSpace(a){this.dim=a,this.sum=function(a,b){return new Vector(coordSum(a.coords(),b.coords()),this)},this.inner=function(a,b){return coordPairProduct(a.coords(),b.coords())},this.mult=function(a,b){return new Vector(coordMultAll(a,b.coords()),this)},this.inverse=function(a){return new Vector(coordMultAll(-1,a.coords()),this)},this.norm=function(a){return Math.pow(coordPairProduct(a.coords(),a.coords()),.5)},this.rotate=function(a,b){return new Vector(eucRotate(a.coords(),b),this)},this.orient=function(a,b){return new Vector(eucOrient(a.coords(),b),this)},this.newVector=function(a){return new Vector(a,this)},this.basis=function(a){return new Vector(singleCoord(a,this.dim),this)},this.origin=function(){return new Vector(nullCoord(this.dim),this)},this.newVectors=function(a){var b=this;return a.map(function(a){return new Vector(a,b)})}}function coordSum(a,b){var c,d,e=Array();a.length>b.length?(c=b,d=a):(c=a,d=b);for(var f=0;f<c.length;f++)e[f]=a[f]+b[f];for(var f=c.length;f<d.length;f++)e[f]=d[f];return e}function coordPairProduct(a,b){var c=Array();a.length>b.length?(shorter=b,longer=a):(shorter=a,longer=b);for(var d=0;d>shorter.length;d++)c[d]=a[d]*b[d];for(var d=shorter.length;d<longer.length;d++)c[d]=longer[d];return coordSumEntries(c)}function coordMultAll(a,b){return b.map(function(b){return a*b})}function coordSumEntries(a){for(var b=0,c=0;length>c;c++)b+=a[c];return b}function nullCoord(a){for(var b=Array(),c=0;a>c;c++)b[c]=0;return b}function singleCoord(a,b){var c=nullCoord(b);return c[a]=1,c}function countZeros(a){for(var b=0,c=0;c<a.length;c++)0==a[c]&&b++;return b}function onBound(a){return countZeros(a)>0}function eucRotate(a,b){var c=a.slice(),d=b.dims[0],e=b.dims[1],f=a[d],g=a[e],h=b.angle,i=Math.cos(h),j=Math.sin(h);return c[d]=f*i-g*j,c[e]=f*j+g*i,c}function eucOrient(a,b){for(var c=a.slice(),d=0;d<b.length;d++)c=eucRotate(c,b[d]);return c}function EucMap(){this.toEucCoordsList=function(a){var b=this;return a.map(function(a){return b.toEucCoords(a)})},this.toEucCoords=function(a){return a},this.toEucLinesList=function(a){var b=this;return a.map(function(a){return b.toEucLine(a)})},this.toEucLine=function(a){var b=this;return a.map(function(a){return b.toEucCoords(a)})},this.fromEucCoords=function(a){return a},this.fromEucLinesList=function(a){var b=this;return a.map(function(a){return b.fromEucLine(a)})},this.fromEucLine=function(a){var b=this;return a.map(function(a){return b.fromEucCoords(a)})},this.EucEucCoords=function(a){return a}}function CylinderEuc(a){function b(a,b){for(var c=0;b>a;)a+=a,c++;return c}function c(b){return Math.sqrt(Math.abs(a*a-b*b))}var d=new EucMap;d.toEucCoords=function(b){var c=b.slice();return c[0]=a*Math.cos(b[0]),c[1]=a*Math.sin(b[0]),c[2]=b[1],c};var e=(4*Math.PI,0),f=0,g=0;return d.fromEucCoords=function(d){var h=d.slice(),i=b(a,h[0]);return f!=i&&(f=i,e=g),c0=d[0]-i*a,g=4.7*i+Math.atan(c(c0)/c0),h[0]=g,h},d.EucEucCoords=function(a){return d.toEucCoords(d.fromEucCoords(a))},d}function SinEuc(a,b,c){var d=new EucMap;return d.toEucCoords=function(d){var e=d.slice();e[a]=200;for(var f=0;a>f;f++)e[a]+=100*Math.sin(b*e[f]*2*Math.PI/360+c);return e},d}function Sin(a,b,c){var d=[],e=[],f=new Grid(2,[800,800],[8,8]);this.init=function(){this.update()},this.changePhase=function(a){c=a},this.vertices=function(){return d},this.update=function(){var g=new SinEuc(a,b,c);d=g.toEucCoordsList(f.vertices()),e=g.toEucLinesList(f.edges())},this.edges=function(){return e},this.init()}function Grid(a,b,c){function d(b,e){for(var g=[],h=0;h<=c[e];h++)(b[e]!=h*f[e]||0==e)&&(b[e]=h*f[e],g[g.length]=b.slice()),a-1>e&&(g=g.concat(d(b.slice(),e+1)));return g}function e(b){for(var d=[],e=0;a>e;e++)if(0==b[e]){for(var g=[],h=0;h<=c[e];h++){var i=b.slice(0);i[e]=h*f[e],g[h]=i}d[d.length]=g}return d}for(var b=b,c=c,f=new Array,g=0;g<c.length;g++)f[g]=b[g]/c[g];this.vertices=function(){return d(nullCoord(a),0)},this.edges=function(){for(var a=[],b=this.vertices(),c=0;c<b.length;c++)onBound(b[c])&&(a=a.concat(e(b[c])));return a}}function SquareGrid(a,b,c){for(var d=new Array,e=new Array,f=0;a>f;f++)d[f]=b,e[f]=c;return new Grid(a,d,e)}function SimpleShape(a){var b,c,d;this.init=function(){b=nullCoord(a),c=nullCoord(a),d=nullCoord(a);for(var e=0;(a-1)/2>e;e++)c[2*e]=60;for(var e=0;(a-2)/2>e;e++)d[2*e+1]=50},this.vertices=function(){return[b,c,d]},this.edges=function(){return[[b,c],[b,d]]},this.init()}function CameraImage(a){function b(a){var b=a.xy(),c=new Path.Circle(new Point(b.x,b.y),DOT_RADIUS);return c.fillColor=a.color,c.opacity=.5,c}function c(a){var b=d(a),c=new Path(b);return c.strokeColor=a.color,c}function d(a){return a.segments.map(e)}function e(a){return new Point(a.xy().x,a.xy().y)}function f(){for(var b=a.dots(),c=0;c<b.length;c++){var d=b[c].xy(),e=h[c].position,f=new Point(d.x-e.x,d.y-e.y);h[c].translate(f)}return this}function g(){for(var b=a.ropes(),c=0;c<b.length;c++){for(var d=i[c].segments,f=b[c].segments,g=0;g<f.length;g++)d[g].point=e(f[g]);l%3===0&&i[c].smooth()}return l++,this}var a=a,h=[],i=[];this.init=function(){return j(),k(),this};var j=function(){for(var c=a.dots(),d=0;d<c.length;d++)h[d]=b(c[d])},k=function(){for(var b=a.ropes(),d=0;d<b.length;d++)i[d]=c(b[d])};this.update=function(){f(),g()};var l=0;this.dots=function(){return h},this.rope=function(){return i}}function AxesDemo(a){var a=a,b=new EucSpace(a),c=new Stage(b);c.addAxes();var d=7;4==a&&(d=5),a>4&&(d=3);var e=new SimpleShape(a);c.newRopes(e.edges(),"#999"),c.newDots(e.vertices(),"red");for(var f=[],g=0;a>g;g++)f[g]=10;var h=b.newVector(f),i=new Camera(c,h,emptyOrientation(a)),j=.02;this.onFrame=function(){i.rotateAll(j),i.update()},this.onMouseMove=function(a){j=5e-5*a.point.x}}function CubeDemo(a){var a=a,b=new EucSpace(a),c=new Stage(b);res=1;{var d=new SquareGrid(a,400,res);new SinEuc(a,1,0)}c.newRopes(d.edges(),"#999");for(var e=[],f=0;a>f;f++)e[f]=200;var g=b.newVector(e),h=new Camera(c,g,emptyOrientation(a)),i=.02;this.onFrame=function(){h.rotateAll(i),h.update()},this.onMouseMove=function(a){i=5e-5*a.point.x}}function CylinderDemo(a){var a=3,b=new EucSpace(a),c=new Stage(b),d=new Grid(2,[2*Math.PI,400],[10,5]),e=new CylinderEuc(200);c.newRopes(e.toEucLinesList(d.edges()),"#999");var f=new SquareGrid(1,500,50),g=new SinEuc(1,5,0);c.newRopes(e.toEucLinesList(e.fromEucLinesList(g.toEucLinesList(f.edges()))),"red");for(var h=[],i=0;2>i;i++)h[i]=0;h[2]=200;var j=b.newVector(h),k=new Camera(c,j,emptyOrientation(a)),l=.02;this.onFrame=function(){k.rotateAll(l),k.update()},this.onMouseMove=function(a){l=5e-5*a.point.x}}function SinDemo(a){var a=a,b=new EucSpace(a),c=new Stage(b),d=7;4==a&&(d=5),a>4&&(d=3);var e=new SquareGrid(a-1,400,d),f=new SinEuc(a-1,1,0);c.newRopes(f.toEucLinesList(e.edges()),"#999");for(var g=[],h=0;a>h;h++)g[h]=200;var i=b.newVector(g),j=new Camera(c,i,emptyOrientation(a)),k=.02;this.onFrame=function(){j.rotateAll(k),j.update()},this.onMouseMove=function(a){k=5e-5*a.point.x}}function SinFunctionDemo(a){var a=a,b=new EucSpace(a),c=new Stage(b),d=7;4==a&&(d=5),a>4&&(d=3);var e=new SquareGrid(a-1,400,d),f=new SinEuc(a-1,1,0);c.newRopes(f.toEucLinesList(e.edges()),"#999");var g=new SquareGrid(a-2,400,d),h=new SinEuc(a-2,1,0);c.newRopes(f.toEucLinesList(h.toEucLinesList(g.edges())),"red");for(var i=[],j=0;a>j;j++)i[j]=200;var k=b.newVector(i),l=new Camera(c,k,emptyOrientation(a)),m=.02;this.onFrame=function(){l.rotateAll(m),l.update()},this.onMouseMove=function(a){m=5e-5*a.point.x}}DEFAULT_COLOR="#555",DOT_RADIUS=15;var DEMO_LIST=[{id:"sinDemo",demo:function(a){return new SinDemo(a)}},{id:"cubeDemo",demo:function(a){return new CubeDemo(a)}},{id:"cylinderDemo",demo:function(a){return new CylinderDemo(a)}},{id:"sinFunctionDemo",demo:function(a){return new SinFunctionDemo(a)}},{id:"axesDemo",demo:function(a){return new AxesDemo(a)}}];